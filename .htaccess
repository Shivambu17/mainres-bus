# ================================
# MainRes Bus System - .htaccess
# Apache 2.4 / XAMPP Compatible
# ================================

# ----------------
# Security Headers
# ----------------
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; style-src 'self' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net; font-src 'self' https://cdnjs.cloudflare.com; img-src 'self' data:"
</IfModule>

# ----------------
# Disable Directory Listing
# ----------------
Options -Indexes

# ----------------
# Protect Sensitive Files
# ----------------
<FilesMatch "\.(sql|ini|log|sh|bak|inc|cfg|dist)$">
    Require all denied
</FilesMatch>

<FilesMatch "^(config|functions|db_setup)\.php$">
    Require all denied
</FilesMatch>

# ----------------
# URL Rewriting
# ----------------
RewriteEngine On

# Remove .php extension
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^(.+)$ $1.php [L]

# ----------------
# Custom Error Pages
# ----------------
ErrorDocument 403 /index.php
ErrorDocument 404 /index.php
ErrorDocument 500 /index.php

# ----------------
# Compression
# ----------------
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# ----------------
# Browser Caching
# ----------------
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
</IfModule>

# ----------------
# Prevent Hotlinking (DISABLED for localhost)
# ----------------
# RewriteCond %{HTTP_REFERER} !^$
# RewriteCond %{HTTP_REFERER} !^https?://(www\.)?yourdomain\.com/ [NC]
# RewriteRule \.(jpg|jpeg|png|gif|svg)$ - [F,L]

# ----------------
# Basic SQL Injection Protection
# ----------------
RewriteCond %{QUERY_STRING} (\<|\>|\'|\"|\%27|\%22|\%3C|\%3E|\%00) [NC]
RewriteRule .* - [F]

# ----------------
# Block Bad Bots
# ----------------
RewriteCond %{HTTP_USER_AGENT} (curl|wget|python|nikto|scan) [NC]
RewriteRule .* - [F]

# ----------------
# PHP Settings (SAFE FOR XAMPP)
# ----------------
php_flag display_errors Off
php_value session.use_strict_mode 1
php_value session.use_only_cookies 1
php_value session.cookie_httponly 1
php_value session.gc_maxlifetime 1440
